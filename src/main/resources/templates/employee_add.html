<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Add employee </title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">



    </head>
    <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#"> Employee Management System</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <a class="nav-link" href="employee">Employees <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="department2">Departments</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="position">Poisitions</a>
                </li>

            </ul>
        </div>
    </nav>

        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

        <div class="container">
            <form class="form-horizontal" style="padding:  10px">
                <div class="form-group">
                    <label for="nameInput" class="col-sm-2 control-label">Name</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="nameInput" placeholder="Name">
                    </div>
                </div>

                <div class="form-group">
                    <label for="surnameInput" class="col-sm-2 control-label">Surname</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="surnameInput" placeholder="Surname">
                    </div>
                </div>

                <div class="form-group">
                    <label for="bDayPicker" class="col-sm-2 control-label">Birthday</label>
                    <div class="col-sm-10">
                        <input type="date" name="bday" id="bDayPicker" class="form-control">
                    </div>
                </div>

                <div class="form-group">
                    <label for="phoneInput" class="col-sm-2 control-label">Phone</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="phoneInput" placeholder="Phone">
                    </div>
                </div>

                <div class="form-group">
                    <label for="emailInput" class="col-sm-2 control-label">Email</label>
                    <div class="col-sm-10">
                        <input type="email" class="form-control" id="emailInput" placeholder="Email">
                    </div>
                </div>

                <div class="form-group">
                    <label for="phoneInput" class="col-sm-2 control-label">Position</label>
                    <div class="col-sm-10">
                        <select class="form-control" id="posDropDown">
                            <option value="">-Select Position-</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="empDatePicker" class="col-sm-2 control-label">Employment Date</label>
                    <div class="col-sm-10">
                        <input type="date" name="empDate" id="empDatePicker" class="form-control">
                    </div>
                </div>

                <div class="form-group">
                    <label for="depsDropDown" class="col-sm-2 control-label">Department</label>
                    <div class="col-sm-10">
                        <select class="form-control" id="depsDropDown">
                            <option value="">-Select Department-</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="parEmpDropDown" class="col-sm-2 control-label">Parent Employer</label>
                    <div class="col-sm-10">
                        <select class="form-control" id="parEmpDropDown">
                            <option value="">-Select Parent Employer-</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button class="btn pull-right" id="saveEmpBtn">Save</button>
                    </div>
                </div>
            </form>
        </div>



        <script>
            // load items to dropDown for Departments
            $(document).ready(function () {

                $.ajax({
                    type: "GET",
                    url: "webresources/department",
                    dataType: "json",
                    success: function (data, textStatus, jqXHR) {
                        if (data.length) {

                            for (var i = 0; i < data.length; i++) {
                                $('#depsDropDown').append('<option value="' + data[i].id + '">' + data[i].name + '</option>');
                            }
                        } else {

                        }
                    },
                    error: function (xhr, status, error) {

                    },
                    complete: function () {
                    }
                });
            });
            // load items to dropDown for Position
            $(document).ready(function () {

                $.ajax({
                    type: "GET",
                    url: "webresources/position",
                    dataType: "json",
                    success: function (data, textStatus, jqXHR) {
                        if (data.length) {

                            for (var i = 0; i < data.length; i++) {
                                $('#posDropDown').append('<option value="' + data[i].id + '">' + data[i].name + '</option>');
                            }
                        } else {

                        }
                    },
                    error: function (xhr, status, error) {

                    },
                    complete: function () {
                    }
                });
            });
            // load items to dropDown for parent Employee
            $(document).ready(function () {
                $.ajax({
                    type: "GET",
                    url: "webresources/employee",
                    dataType: "json",
                    success: function (data, textStatus, jqXHR) {
                        if (data.length) {
                            for (var i = 0; i < data.length; i++) {
                                $('#parEmpDropDown').append('<option value="' + data[i].id + '">' + data[i].name + " " + data[i].surname + '</option>');
                            }

                        }
                    },
                    error: function (xhr, status, error) {

                    },
                    complete: function () {
                    }
                });
                document.getElementById('empDatePicker').valueAsDate = new Date();

            });

            // add new employee 
            $(document).on('click', '#saveEmpBtn', function () {

                var name = $.trim($('#nameInput').val());
                var surname = $.trim($('#surnameInput').val());
                var bday = $.trim($('#bDayPicker').val());
                var phone = $.trim($('#phoneInput').val());
                var email = $.trim($('#emailInput').val());

                var posId = $('#posDropDown').val();
                var depId = $('#depsDropDown').val();
                var empDate = $.trim($('#empDatePicker').val()) + 'T00:00:00';
                var parentId = $.trim($('#parEmpDropDown').val());


                if (name.length == 0) {
                    alert('Enter name!');
                    return false;
                }
                if (surname.length == 0) {
                    alert('Enter surname!');
                    return false;
                }
                if (bday.length == 0) {
                    alert('Enter birthday!');
                    return false;
                } else {
                    bday += 'T00:00:00';
                }
                if (posId == 0) {
                    alert('enter position!');
                    return false;
                }
                if (depId == 0) {
                    alert('enter deparetment!');
                    return false;
                }
                var param = null;
                if (parentId.length > 0) {
                    param = JSON.stringify({
                        name: name,
                        surname: surname,
                        birthDate: bday,
                        email: email,
                        phone: phone,
                        employmentDate: empDate,
                        departmentId: {
                            id: depId
                        },
                        positionId: {
                            id: posId
                        },
                        parentEmployeeId: {
                            id: parentId
                        }
                    });
                } else {
                    param = JSON.stringify({
                        name: name,
                        surname: surname,
                        birthDate: bday,
                        email: email,
                        phone: phone,
                        employmentDate: empDate,
                        departmentId: {
                            id: depId
                        },
                        positionId: {
                            id: posId
                        }
                    });
                }
                $.ajax({
                    type: "POST",
                    url: "webresources/employee",
                    dataType: "json",
                    contentType: 'application/json',
                    data: param,
                    success: function (data, textStatus, jqXHR) {
                        window.location.href = 'employee.html';
                    },
                    error: function (xhr, status, error) {

                    },
                    complete: function () {
                    }
                });

                return false;
            });
        </script>
    </body>
</html>
